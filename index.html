<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Webhook Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0; min-height:100vh; background:#000;
  display:flex; justify-content:center; align-items:center;
  font-family:system-ui,sans-serif; color:#fee2e2;
}
.container{
  width:94%; max-width:560px; padding:24px;
  background:linear-gradient(145deg,#1a0000,#000);
  border-radius:18px; border:1px solid #7f1d1d;
}
h1{text-align:center;margin-bottom:18px;font-size:26px}
input,textarea{
  width:100%; margin-top:10px; padding:13px;
  border-radius:12px; background:#000; color:#fee2e2;
  border:1px solid #7f1d1d; font-size:14px;
}
.tokens{height:120px}
.msg{height:130px}
.row{display:flex; gap:10px}
.row input{flex:1}
button{
  width:100%; margin-top:12px; padding:14px;
  font-size:15px; font-weight:bold; border-radius:14px;
  border:none; cursor:pointer; color:#fff;
}
.send{background:#dc2626}
.pause{background:#92400e}
.stop{background:#374151}
.status{margin-top:10px; text-align:center; font-size:13px}
.log{
  margin-top:10px; font-size:12px;
  max-height:110px; overflow:auto;
}
.small{font-size:11px; opacity:.8}
</style>
</head>

<body>
<div class="container">
  <h1>Webhook</h1>

  <!-- Webhook URL -->
  <textarea id="urls" class="tokens"
    placeholder="Webhook URLã‚’æ”¹è¡Œã§æœ€å¤§50å€‹ã¾ã§"></textarea>

  <!-- ğŸ†• ã‚µãƒ¼ãƒãƒ¼ID -->
  <input id="serverId" placeholder="ã‚µãƒ¼ãƒãƒ¼IDï¼ˆç®¡ç†ç”¨ï¼‰">

  <input id="name" placeholder="Webhookå">

  <textarea id="msg" class="msg" maxlength="500"
    placeholder="é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæœ€å¤§500æ–‡å­—ï¼‰"></textarea>

  <div class="row">
    <input id="interval" type="number" value="1000" min="100"
      placeholder="é–“éš”(ms)">
    <input id="limit" type="number"
      placeholder="å›æ•°ï¼ˆç©ºï¼ç„¡é™ï¼‰">
  </div>

  <button class="send" onclick="start()">å®Ÿè¡Œ</button>
  <button class="pause" onclick="togglePause()">ä¸€æ™‚åœæ­¢ / å†é–‹</button>
  <button class="stop" onclick="stop()">åœæ­¢</button>

  <div class="status" id="status">å¾…æ©Ÿä¸­</div>
  <div class="status small">
    ç·é€ä¿¡: <span id="count">0</span> /
    ç¾åœ¨URL: <span id="current">-</span>
  </div>
  <div class="log" id="log"></div>
</div>

<script>
let timer=null, running=false, paused=false;
let urls=[], index=0, count=0;
let stats=new Map();
let backoffUntil=0;

const els={
  urls:document.getElementById("urls"),
  server:document.getElementById("serverId"),
  msg:document.getElementById("msg"),
  name:document.getElementById("name"),
  interval:document.getElementById("interval"),
  limit:document.getElementById("limit"),
  status:document.getElementById("status"),
  count:document.getElementById("count"),
  current:document.getElementById("current"),
  log:document.getElementById("log")
};

function log(t){
  els.log.innerHTML+=t+"<br>";
  if(els.log.children.length>200){
    els.log.innerHTML=els.log.innerHTML.split("<br>").slice(-150).join("<br>");
  }
  els.log.scrollTop=els.log.scrollHeight;
}

function save(){
  localStorage.setItem("wh_cfg",JSON.stringify({
    urls:els.urls.value,
    server:els.server.value,
    msg:els.msg.value,
    name:els.name.value,
    interval:els.interval.value,
    limit:els.limit.value
  }));
}

function load(){
  const d=JSON.parse(localStorage.getItem("wh_cfg")||"null");
  if(!d) return;
  Object.keys(d).forEach(k=>{
    if(els[k]) els[k].value=d[k]||"";
  });
}
load();

function start(){
  if(running) return;

  urls=els.urls.value.split("\n").map(v=>v.trim()).filter(Boolean);
  if(urls.length===0) return els.status.textContent="Webhookãªã—";
  if(urls.length>50) return els.status.textContent="æœ€å¤§50å€‹";
  if(!els.msg.value.trim()) return els.status.textContent="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç©º";

  save();
  running=true; paused=false; count=0; index=0;
  stats.clear(); backoffUntil=0;
  els.count.textContent="0";
  els.status.textContent="é€ä¿¡ä¸­";
  log(`â–¶ é–‹å§‹ | ServerID: ${els.server.value || "æœªå…¥åŠ›"}`);

  timer=setInterval(tick, parseInt(els.interval.value)||1000);
}

function tick(){
  if(!running || paused) return;
  if(Date.now()<backoffUntil) return;

  const limit=parseInt(els.limit.value)||Infinity;
  if(count>=limit){ stop(); return; }

  const url=urls[index];
  els.current.textContent=index+1;
  send(url);
  index=(index+1)%urls.length;
}

function send(url){
  fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      content:els.msg.value,
      username:els.name.value||"Webhook"
    })
  }).then(r=>{
    if(r.status===429){
      backoffUntil=Date.now()+3000;
      log("âš  ãƒ¬ãƒ¼ãƒˆåˆ¶é™ â†’ 3ç§’å¾…æ©Ÿ");
      return;
    }
    count++; els.count.textContent=count;
    stats.set(url,(stats.get(url)||0)+1);
    log("âœ” é€ä¿¡æˆåŠŸ");
  }).catch(()=>log("âœ– é€ä¿¡å¤±æ•—"));
}

function togglePause(){
  if(!running) return;
  paused=!paused;
  els.status.textContent=paused?"ä¸€æ™‚åœæ­¢ä¸­":"é€ä¿¡ä¸­";
  log(paused?"â¸ ä¸€æ™‚åœæ­¢":"â–¶ å†é–‹");
}

function stop(){
  clearInterval(timer); timer=null;
  running=false; paused=false;
  els.status.textContent="åœæ­¢";
  log("â–  åœæ­¢");
}
</script>
</body>
</html>
